<h1> index program for <%= @programs.first %></h1>

<% meal_cal_date = [] %>
<% meal_prot_date = [] %>
<% meal_fat_date = [] %>
<% meal_carb_date = [] %>

<% @programs.each do |program| %>
  <%= link_to program, program_meals_path(program) %>
  <% program.meals.each do |meal| %>
   <p> <% meal.name %> <% meal.start_time %>  </p>
   <p> <% calorie(meal) %> </p>
   <% meal_cal_date << [meal.start_time, calorie(meal)] %>
   <% meal_prot_date << [meal.start_time, macro(meal)[0]] %>
   <% meal_fat_date << [meal.start_time, macro(meal)[1]] %>
   <% meal_carb_date << [meal.start_time, macro(meal)[2]] %>
  <% end %>
<% end %>

<% @programs.each do |program| %>
  <% program.meals.group_by(&:start_time).each do |day, meals| %>
    <% sum_p = sum_c =sum_l = sum_c = sum_cal = 0 %>
      <table class = "nutri-table-meal">
        <thead>
          <tr>
            <th > Date </th>
            <th > Protein</th>
            <th > Lipid</th>
            <th > Carbs</th>
            <th > Calories</th>
          </tr>
        </thead>
        <tbody>
          <% sum_p += meals.map{|meal| macro(meal)[0]}.sum()  %>
          <% sum_l += meals.map{|meal| macro(meal)[1]}.sum()  %>
          <% sum_c += meals.map{|meal| macro(meal)[2]}.sum()  %>
          <% sum_cal += meals.map{|meal| calorie(meal)}.sum() %>
        <tr>
          <td> <%= link_to meals.last.start_time.strftime("%m/%d/%Y"), program_meals_path(program, date:meals.last.start_time) %>  </td>
          <td class = "cell-total"> <%= sum_p %> </td>
          <td class = "cell-total"> <%= sum_l %> </td>
          <td class = "cell-total"> <%= sum_c %> </td>
          <td class = "cell-total"> <%= sum_cal %> </td>
          <% sum_p = sum_c =sum_l = sum_c = sum_cal = 0 %>
        </tr>
      </tbody>
    </table>
  <% end %>
<% end %>























<div class = "meal-stat">
  <div> <%= line_chart meal_prot_date, ytitle: "Protein" %> </div>
  <div> <%= line_chart meal_fat_date, ytitle: "Fats" %> </div>
  <div> <%= line_chart meal_carb_date, ytitle: "Carbs" %> </div>
</div>

<div class = "meal-stat">
  <%= line_chart meal_cal_date, ytitle: "Calorie" %>
</div>

<!-- better with activerecords request ? -->
<!--  <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("(carbs*4)+(proteins*4)+(fats*9)"), ytitle: "Calorie" %>
 <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("proteins"), ytitle: "proteins" %>
 <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("fats"), ytitle: "fats" %>
 <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("carbs"), ytitle: "carbs" %>
 -->
