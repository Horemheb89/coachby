<h1> index program for <%= @programs.first %></h1>

<% meal_cal_date = [] %>
<% meal_prot_date = [] %>
<% meal_fat_date = [] %>
<% meal_carb_date = [] %>

<% @programs.each do |program| %>
  <%= link_to program, program_meals_path(program) %>
  <% program.meals.each do |meal| %>
   <p> <% meal.name %> <% meal.start_time %>  </p>
   <p> <% calorie(meal) %> </p>
   <% meal_cal_date << [meal.start_time, calorie(meal)] %>
   <% meal_prot_date << [meal.start_time, macro(meal)[0]] %>
   <% meal_fat_date << [meal.start_time, macro(meal)[1]] %>
   <% meal_carb_date << [meal.start_time, macro(meal)[2]] %>
  <% end %>
<% end %>

<% @programs.each do |program| %>
  <% program.meals.each do |meal| %>
      <table class = "nutri-table-meal">
        <thead>
            <tr>
              <th > Date </th>
              <th > Protein</th>
              <th > Lipid</th>
              <th > Carbs</th>
              <th > Calories</th>
            </tr>
        </thead>
        <tbody>
          <% sum_p = sum_c =sum_l = sum_c = sum_cal = 0 %>
          <% meal.doses.each do |dose| %>
          <!-- put <%= %> to see meal/days stats  -->
              <% meal.start_time.strftime("%m/%d/%Y") %>
              <% ((dose.quantity * dose.ingredient.proteins)/100).round   %>
              <% ((dose.quantity * dose.ingredient.fats)/100).round  %>
              <% ((dose.quantity * dose.ingredient.carbs)/100).round  %>

              <% (((dose.quantity * dose.ingredient.proteins)/100)*4 +
              ((dose.quantity * dose.ingredient.fats)/100) * 9 +
              ((dose.quantity * dose.ingredient.carbs)*4)/100) %>

              <% sum_p += ((dose.quantity * dose.ingredient.proteins)/100).round  %>
              <% sum_l += ((dose.quantity * dose.ingredient.fats)/100).round %>
              <% sum_c += ((dose.quantity * dose.ingredient.carbs)/100).round   %>

              <% sum_cal += (((dose.quantity * dose.ingredient.proteins)/100) * 4 +
                            ((dose.quantity * dose.ingredient.fats)/100) * 9 +
                            ((dose.quantity * dose.ingredient.carbs)/100) * 4)  %>

            <!--   -->
            <% if meal.doses.last == dose %>
              <tr>
                <td> <%= meal.start_time.strftime("%m/%d/%Y") %>  </td>
                <td class = "cell-total"> <%= sum_p %> </td>
                <td class = "cell-total"> <%= sum_l %> </td>
                <td class = "cell-total"> <%= sum_c %> </td>
                <td class = "cell-total"> <%= sum_cal %> </td>
                <% sum_p = sum_c =sum_l = sum_c = sum_cal = 0 %>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    <% end %>
<% end %>



<div class = "meal-stat">
  <div> <%= line_chart meal_prot_date, ytitle: "Protein" %> </div>
  <div> <%= line_chart meal_fat_date, ytitle: "Fats" %> </div>
  <div> <%= line_chart meal_carb_date, ytitle: "Carbs" %> </div>
</div>

<div class = "meal-stat">
  <%= line_chart meal_cal_date, ytitle: "Calorie" %>
</div>

<!-- better with activerecords request ? -->
<!--  <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("(carbs*4)+(proteins*4)+(fats*9)"), ytitle: "Calorie" %>
 <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("proteins"), ytitle: "proteins" %>
 <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("fats"), ytitle: "fats" %>
 <%= line_chart Meal.group_by_day(:start_time).joins(:doses).joins(:ingredients).sum("carbs"), ytitle: "carbs" %>
 -->
